<!-- Launches the localization using for amcl the robot -->

<launch>
    <!--arg name="darknet"         default="true" /-->
    <arg name="fake_localization" default="false" />
    <arg name="robot_name" />
    <arg name="map_name" />
    <arg name="x_pos" />
    <arg name="y_pos" />

    <!-- Map server -->
    <node name="map_server" pkg="map_server" type="map_server"
          args="$(find soccer_common)/maps/$(arg map_name).yaml">
        <param name="frame_id" value="world"/>
    </node>

    <!-- Line and goal detection -->
    <node pkg="soccer_fieldline_detection" type="soccer_fieldline_detector" name="soccer_fieldline_detector"
          output="screen" >
        <rosparam file="$(find soccer_fieldline_detection)/config/fieldline_detection.yaml" command="load"/>
    </node>

    <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan" unless="$(arg fake_localization)">
        <rosparam file="$(find soccer_fieldline_detection)/config/pointcloud_to_laserscan.yaml" command="load" />
        <remap from="cloud_in" to="field_point_cloud" />
    </node>

    <!-- Ball Detection -->


    <node pkg="soccer_strategy" type="fall_detector.py" name="fall_detector"/>
    <node pkg="soccer_strategy" type="main.py" name="main"/>
    <!-- Complementary filter -->
    <node pkg="imu_complementary_filter" type="complementary_filter_node" name="imu_complementary_filter">
        <rosparam file="$(find soccerbot)/config/imu_complementary_filter.yaml" command="load" />
        <remap from="imu/data_raw" to="imu_raw" />
        <remap from="imu/data" to="imu_data" />
    </node>

    <!-- IMU location -->
    <node pkg="robot_pose_ekf" type="robot_pose_ekf" name="robot_pose_ekf">
        <rosparam file="$(find soccerbot)/config/robot_pose_ekf.yaml" command="load" />
        <remap from="robot_pose_ekf/odom_combined" to="odom_combined" />

    </node>

    <!-- AMCL Localization -->
    <node pkg="amcl" type="amcl" name="amcl" unless="$(arg fake_localization)">
        <rosparam file="$(find soccerbot)/config/amcl.yaml" command="load" />
        <param name="initial_pose_x" value="$(arg x_pos)" />
        <param name="initial_pose_y" value="$(arg y_pos)" />
    </node>

    <node pkg="fake_localization" type="fake_localization" name="fake_localization" if="$(arg fake_localization)">
        <remap from="base_pose_ground_truth" to="odom_ground_truth" />
        <param name="global_frame_id" value="world" />
        <param name="base_frame_id" value="base_footprint" />
    </node>



</launch>