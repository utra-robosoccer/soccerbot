<!-- Launches the localization using for amcl the robot -->

<launch>
    <arg name="darknet"         default="true" />
    <arg name="robot_name" />

    <!-- Map server -->
    <node name="map_server" pkg="map_server" type="map_server"
          args="$(find soccer_common)/maps/robocup.yaml">
        <param name="frame_id" value="map"/>
    </node>

    <!-- Line and goal detection -->
    <node pkg="soccer_fieldline_detection" type="soccer_fieldline_detector" name="soccer_fieldline_detector"
          output="screen">
        <rosparam file="$(find soccer_fieldline_detection)/config/fieldline_detection.yaml" command="load"/>
    </node>

    <rosparam file="$(find soccer_fieldline_detection)/config/pointcloud_to_laserscan.yaml" command="load" />
    <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan">
        <remap from="cloud_in" to="field_point_cloud" />
    </node>

    <!-- Ball Detection -->
    <node name="ball_detector" pkg="soccer_fieldline_detection" type="ball_detector"/>

    <rosparam command="load" ns="darknet_ros" file="$(find soccerbot)/config/darknet_ros.yaml"/>
    <rosparam command="load" ns="darknet_ros" file="$(find soccerbot)/config/yolov2-tiny.yaml"/>
    <rosparam ns="darknet_ros" param="subscribers/camera_reading/topic" subst_value="true" >/$(arg robot_name)/camera/image_raw</rosparam>
    <rosparam ns="darknet_ros" param="publishers/object_detector/topic" subst_value="true" >/$(arg robot_name)/darknet_ros/found_object</rosparam>
    <rosparam ns="darknet_ros" param="publishers/bounding_boxes/topic" subst_value="true" >/$(arg robot_name)/darknet_ros/bounding_boxes</rosparam>
    <rosparam ns="darknet_ros" param="publishers/detection_image/topic" subst_value="true" >/$(arg robot_name)/darknet_ros/detection_image</rosparam>
    <node pkg="darknet_ros" type="darknet_ros" name="darknet_ros" output="log">
        <param name="weights_path"          value="$(find darknet_ros)/yolo_network_config/weights" />
        <param name="config_path"           value="$(find darknet_ros)/yolo_network_config/cfg" />
    </node>

    <!-- AMCL Localization -->
<!--    <include file="$(find soccerbot)/launch/modules/amcl.launch">-->
<!--        <arg name="use_map_topic"   value="true"/>-->
<!--        <arg name="scan_topic"      value="vision_poses"/>-->
<!--        <arg name="initial_pose_x"  value="0.0"/>-->
<!--        <arg name="initial_pose_y"  value="0.0"/>-->
<!--        <arg name="initial_pose_a"  value="0.0"/>-->
<!--        <arg name="odom_frame_id"   value="odom"/>-->
<!--        <arg name="base_frame_id"   value="base_link"/>-->
<!--        <arg name="global_frame_id" value="map"/>-->
<!--    </include>-->

<!--><node pkg="laser_filters" type="scan_to_scan_filter_chain" name="laser_filter">
            <rosparam command="load" file="$(find soccer_fieldline_detection)/config/laser_filter.yaml" />

    </node>-->

 <!-- AMCL -->

     <!--><node pkg="amcl" type="amcl" name="amcl">
        <param name = "use_sim_time" value = "true" />
        <param name = "use_map_topic" value = "true"/>
        <param name = "scan_topic" value = "scan_filtered"/>
        <param name="initial_pose_x" value="0.0"/>
        <param name="initial_pose_y" value="0.0"/>
        <param name="initial_pose_a" value="0.0"/>
        <param name = "odom_frame_id" value = "odom"/>
        <param name = "base_frame_id" value = "base_link"/>
        <param name = "global_frame_id" value = "map"/>
        <remap from="scan" to="scan_filtered" />
    </node>-->


</launch>