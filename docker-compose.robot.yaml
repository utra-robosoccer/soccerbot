version: "3.3"

networks:
  soccer_network:
    ipam:
      config:
        - subnet: 172.18.0.0/24

services:
  friendly1:
    extends:
      file: docker-compose.yaml
      service: friendly
    image: utrarobosoccer/soccerbot:arm64
    build:
      context: .
      target: builder
      args:
        - BUILDKIT_INLINE_CACHE=1
        - USER=${USER}
        - BASE_IMAGE=arm64v8/ros:noetic-robot
        - ARCHITECTURE=sbsa
      cache_from:
        - utrarobosoccer/soccerbot:arm64
    volumes:
      - /usr/lib/aarch64-linux-gnu/tegra:/usr/lib/aarch64-linux-gnu/tegra
    command:
      /bin/bash -c "export ROS_MASTER_URI=http://$$(hostname -i):11311 && export ROS_IP=$$(hostname -i) &&
      source ~/catkin_ws/devel/setup.bash &&
      roslaunch soccerbot soccerbot.launch simulation:=false __ns:=robot$$ROBOCUP_ROBOT_ID || sleep infinity;"
    environment:
      ROBOCUP_ROBOT_ID: 1
      ROBOCUP_TEAM_COLOR: "red"
      ROBOCUP_SIMULATOR_ADDR: "simulator:10001"
      ROBOCUP_MIRROR_SERVER_IP: "simulator"
      ROBOCUP_GAMECONTROLLER_IP: "simulator"
      ROBOCUP_TEAM_ID: 16
      PYTHONUNBUFFERED: 1
